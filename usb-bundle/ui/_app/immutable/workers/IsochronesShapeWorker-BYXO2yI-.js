(function(){"use strict";var Y=63710088e-1,ut={centimeters:Y*100,centimetres:Y*100,degrees:360/(2*Math.PI),feet:Y*3.28084,inches:Y*39.37,kilometers:Y/1e3,kilometres:Y/1e3,meters:Y,metres:Y,miles:Y/1609.344,millimeters:Y*1e3,millimetres:Y*1e3,nauticalmiles:Y/1852,radians:1,yards:Y*1.0936};function Re(i,e,t={}){const r={type:"Feature"};return(t.id===0||t.id)&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.properties=e||{},r.geometry=i,r}function Ve(i,e,t={}){if(!i)throw new Error("coordinates is required");if(!Array.isArray(i))throw new Error("coordinates must be an Array");if(i.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ke(i[0])||!Ke(i[1]))throw new Error("coordinates must contain numbers");return Re({type:"Point",coordinates:i},e,t)}function Ye(i,e,t={}){for(const s of i){if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(s[s.length-1].length!==s[0].length)throw new Error("First and last Position are not equivalent.");for(let h=0;h<s[s.length-1].length;h++)if(s[s.length-1][h]!==s[0][h])throw new Error("First and last Position are not equivalent.")}return Re({type:"Polygon",coordinates:i},e,t)}function ft(i,e={}){const t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=i,t}function at(i,e,t={}){return Re({type:"MultiPolygon",coordinates:i},e,t)}function ht(i,e="kilometers"){const t=ut[e];if(!t)throw new Error(e+" units is invalid");return i/t}function $e(i){return i%(2*Math.PI)*180/Math.PI}function Te(i){return i%360*Math.PI/180}function Ke(i){return!isNaN(i)&&i!==null&&!Array.isArray(i)}function ct(i){if(!i)throw new Error("coord is required");if(!Array.isArray(i)){if(i.type==="Feature"&&i.geometry!==null&&i.geometry.type==="Point")return[...i.geometry.coordinates];if(i.type==="Point")return[...i.coordinates]}if(Array.isArray(i)&&i.length>=2&&!Array.isArray(i[0])&&!Array.isArray(i[1]))return[...i];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function ue(i,e,t,r={}){const s=ct(i),h=Te(s[0]),m=Te(s[1]),g=Te(t),v=ht(e,r.units),w=Math.asin(Math.sin(m)*Math.cos(v)+Math.cos(m)*Math.sin(v)*Math.cos(g)),T=h+Math.atan2(Math.sin(g)*Math.sin(v)*Math.cos(m),Math.cos(v)-Math.sin(m)*Math.sin(w)),R=$e(T),_=$e(w);return Ve([R,_],r.properties)}function pt(i,e,t={}){const r=t.steps||64,s=t.properties?t.properties:!Array.isArray(i)&&i.type==="Feature"&&i.properties?i.properties:{},h=[];for(let m=0;m<r;m++)h.push(ue(i,e,m*-360/r,t).geometry.coordinates);return h.push(h[0]),Ye([h],s)}var gt=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,be=Math.ceil,$=Math.floor,V="[BigNumber Error] ",Xe=V+"Number primitive has more than 15 significant digits: ",W=1e14,L=14,Oe=9007199254740991,_e=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],ne=1e7,G=1e9;function He(i){var e,t,r,s=S.prototype={constructor:S,toString:null,valueOf:null},h=new S(1),m=20,g=4,v=-7,w=21,T=-1e7,R=1e7,_=!1,A=1,q=0,U={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"Â ",suffix:""},F="0123456789abcdefghijklmnopqrstuvwxyz",Ge=!0;function S(n,o){var l,y,f,c,x,u,a,d,p=this;if(!(p instanceof S))return new S(n,o);if(o==null){if(n&&n._isBigNumber===!0){p.s=n.s,!n.c||n.e>R?p.c=p.e=null:n.e<T?p.c=[p.e=0]:(p.e=n.e,p.c=n.c.slice());return}if((u=typeof n=="number")&&n*0==0){if(p.s=1/n<0?(n=-n,-1):1,n===~~n){for(c=0,x=n;x>=10;x/=10,c++);c>R?p.c=p.e=null:(p.e=c,p.c=[n]);return}d=String(n)}else{if(!gt.test(d=String(n)))return r(p,d,u);p.s=d.charCodeAt(0)==45?(d=d.slice(1),-1):1}(c=d.indexOf("."))>-1&&(d=d.replace(".","")),(x=d.search(/e/i))>0?(c<0&&(c=x),c+=+d.slice(x+1),d=d.substring(0,x)):c<0&&(c=d.length)}else{if(P(o,2,F.length,"Base"),o==10&&Ge)return p=new S(n),H(p,m+p.e+1,g);if(d=String(n),u=typeof n=="number"){if(n*0!=0)return r(p,d,u,o);if(p.s=1/n<0?(d=d.slice(1),-1):1,S.DEBUG&&d.replace(/^0\.0*|\./,"").length>15)throw Error(Xe+n)}else p.s=d.charCodeAt(0)===45?(d=d.slice(1),-1):1;for(l=F.slice(0,o),c=x=0,a=d.length;x<a;x++)if(l.indexOf(y=d.charAt(x))<0){if(y=="."){if(x>c){c=a;continue}}else if(!f&&(d==d.toUpperCase()&&(d=d.toLowerCase())||d==d.toLowerCase()&&(d=d.toUpperCase()))){f=!0,x=-1,c=0;continue}return r(p,String(n),u,o)}u=!1,d=t(d,o,10,p.s),(c=d.indexOf("."))>-1?d=d.replace(".",""):c=d.length}for(x=0;d.charCodeAt(x)===48;x++);for(a=d.length;d.charCodeAt(--a)===48;);if(d=d.slice(x,++a)){if(a-=x,u&&S.DEBUG&&a>15&&(n>Oe||n!==$(n)))throw Error(Xe+p.s*n);if((c=c-x-1)>R)p.c=p.e=null;else if(c<T)p.c=[p.e=0];else{if(p.e=c,p.c=[],x=(c+1)%L,c<0&&(x+=L),x<a){for(x&&p.c.push(+d.slice(0,x)),a-=L;x<a;)p.c.push(+d.slice(x,x+=L));x=L-(d=d.slice(x)).length}else x-=a;for(;x--;d+="0");p.c.push(+d)}}else p.c=[p.e=0]}S.clone=He,S.ROUND_UP=0,S.ROUND_DOWN=1,S.ROUND_CEIL=2,S.ROUND_FLOOR=3,S.ROUND_HALF_UP=4,S.ROUND_HALF_DOWN=5,S.ROUND_HALF_EVEN=6,S.ROUND_HALF_CEIL=7,S.ROUND_HALF_FLOOR=8,S.EUCLID=9,S.config=S.set=function(n){var o,l;if(n!=null)if(typeof n=="object"){if(n.hasOwnProperty(o="DECIMAL_PLACES")&&(l=n[o],P(l,0,G,o),m=l),n.hasOwnProperty(o="ROUNDING_MODE")&&(l=n[o],P(l,0,8,o),g=l),n.hasOwnProperty(o="EXPONENTIAL_AT")&&(l=n[o],l&&l.pop?(P(l[0],-G,0,o),P(l[1],0,G,o),v=l[0],w=l[1]):(P(l,-G,G,o),v=-(w=l<0?-l:l))),n.hasOwnProperty(o="RANGE"))if(l=n[o],l&&l.pop)P(l[0],-G,-1,o),P(l[1],1,G,o),T=l[0],R=l[1];else if(P(l,-G,G,o),l)T=-(R=l<0?-l:l);else throw Error(V+o+" cannot be zero: "+l);if(n.hasOwnProperty(o="CRYPTO"))if(l=n[o],l===!!l)if(l)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))_=l;else throw _=!l,Error(V+"crypto unavailable");else _=l;else throw Error(V+o+" not true or false: "+l);if(n.hasOwnProperty(o="MODULO_MODE")&&(l=n[o],P(l,0,9,o),A=l),n.hasOwnProperty(o="POW_PRECISION")&&(l=n[o],P(l,0,G,o),q=l),n.hasOwnProperty(o="FORMAT"))if(l=n[o],typeof l=="object")U=l;else throw Error(V+o+" not an object: "+l);if(n.hasOwnProperty(o="ALPHABET"))if(l=n[o],typeof l=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(l))Ge=l.slice(0,10)=="0123456789",F=l;else throw Error(V+o+" invalid: "+l)}else throw Error(V+"Object expected: "+n);return{DECIMAL_PLACES:m,ROUNDING_MODE:g,EXPONENTIAL_AT:[v,w],RANGE:[T,R],CRYPTO:_,MODULO_MODE:A,POW_PRECISION:q,FORMAT:U,ALPHABET:F}},S.isBigNumber=function(n){if(!n||n._isBigNumber!==!0)return!1;if(!S.DEBUG)return!0;var o,l,y=n.c,f=n.e,c=n.s;e:if({}.toString.call(y)=="[object Array]"){if((c===1||c===-1)&&f>=-G&&f<=G&&f===$(f)){if(y[0]===0){if(f===0&&y.length===1)return!0;break e}if(o=(f+1)%L,o<1&&(o+=L),String(y[0]).length==o){for(o=0;o<y.length;o++)if(l=y[o],l<0||l>=W||l!==$(l))break e;if(l!==0)return!0}}}else if(y===null&&f===null&&(c===null||c===1||c===-1))return!0;throw Error(V+"Invalid BigNumber: "+n)},S.maximum=S.max=function(){return ot(arguments,-1)},S.minimum=S.min=function(){return ot(arguments,1)},S.random=(function(){var n=9007199254740992,o=Math.random()*n&2097151?function(){return $(Math.random()*n)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(l){var y,f,c,x,u,a=0,d=[],p=new S(h);if(l==null?l=m:P(l,0,G),x=be(l/L),_)if(crypto.getRandomValues){for(y=crypto.getRandomValues(new Uint32Array(x*=2));a<x;)u=y[a]*131072+(y[a+1]>>>11),u>=9e15?(f=crypto.getRandomValues(new Uint32Array(2)),y[a]=f[0],y[a+1]=f[1]):(d.push(u%1e14),a+=2);a=x/2}else if(crypto.randomBytes){for(y=crypto.randomBytes(x*=7);a<x;)u=(y[a]&31)*281474976710656+y[a+1]*1099511627776+y[a+2]*4294967296+y[a+3]*16777216+(y[a+4]<<16)+(y[a+5]<<8)+y[a+6],u>=9e15?crypto.randomBytes(7).copy(y,a):(d.push(u%1e14),a+=7);a=x/7}else throw _=!1,Error(V+"crypto unavailable");if(!_)for(;a<x;)u=o(),u<9e15&&(d[a++]=u%1e14);for(x=d[--a],l%=L,x&&l&&(u=_e[L-l],d[a]=$(x/u)*u);d[a]===0;d.pop(),a--);if(a<0)d=[c=0];else{for(c=-1;d[0]===0;d.splice(0,1),c-=L);for(a=1,u=d[0];u>=10;u/=10,a++);a<L&&(c-=L-a)}return p.e=c,p.c=d,p}})(),S.sum=function(){for(var n=1,o=arguments,l=new S(o[0]);n<o.length;)l=l.plus(o[n++]);return l},t=(function(){var n="0123456789";function o(l,y,f,c){for(var x,u=[0],a,d=0,p=l.length;d<p;){for(a=u.length;a--;u[a]*=y);for(u[0]+=c.indexOf(l.charAt(d++)),x=0;x<u.length;x++)u[x]>f-1&&(u[x+1]==null&&(u[x+1]=0),u[x+1]+=u[x]/f|0,u[x]%=f)}return u.reverse()}return function(l,y,f,c,x){var u,a,d,p,E,b,O,M,C=l.indexOf("."),B=m,I=g;for(C>=0&&(p=q,q=0,l=l.replace(".",""),M=new S(y),b=M.pow(l.length-C),q=p,M.c=o(ee(X(b.c),b.e,"0"),10,f,n),M.e=M.c.length),O=o(l,y,f,x?(u=F,n):(u=n,F)),d=p=O.length;O[--p]==0;O.pop());if(!O[0])return u.charAt(0);if(C<0?--d:(b.c=O,b.e=d,b.s=c,b=e(b,M,B,I,f),O=b.c,E=b.r,d=b.e),a=d+B+1,C=O[a],p=f/2,E=E||a<0||O[a+1]!=null,E=I<4?(C!=null||E)&&(I==0||I==(b.s<0?3:2)):C>p||C==p&&(I==4||E||I==6&&O[a-1]&1||I==(b.s<0?8:7)),a<1||!O[0])l=E?ee(u.charAt(1),-B,u.charAt(0)):u.charAt(0);else{if(O.length=a,E)for(--f;++O[--a]>f;)O[a]=0,a||(++d,O=[1].concat(O));for(p=O.length;!O[--p];);for(C=0,l="";C<=p;l+=u.charAt(O[C++]));l=ee(l,d,u.charAt(0))}return l}})(),e=(function(){function n(y,f,c){var x,u,a,d,p=0,E=y.length,b=f%ne,O=f/ne|0;for(y=y.slice();E--;)a=y[E]%ne,d=y[E]/ne|0,x=O*a+d*b,u=b*a+x%ne*ne+p,p=(u/c|0)+(x/ne|0)+O*d,y[E]=u%c;return p&&(y=[p].concat(y)),y}function o(y,f,c,x){var u,a;if(c!=x)a=c>x?1:-1;else for(u=a=0;u<c;u++)if(y[u]!=f[u]){a=y[u]>f[u]?1:-1;break}return a}function l(y,f,c,x){for(var u=0;c--;)y[c]-=u,u=y[c]<f[c]?1:0,y[c]=u*x+y[c]-f[c];for(;!y[0]&&y.length>1;y.splice(0,1));}return function(y,f,c,x,u){var a,d,p,E,b,O,M,C,B,I,N,D,ve,De,Ue,Q,pe,Z=y.s==f.s?1:-1,z=y.c,k=f.c;if(!z||!z[0]||!k||!k[0])return new S(!y.s||!f.s||(z?k&&z[0]==k[0]:!k)?NaN:z&&z[0]==0||!k?Z*0:Z/0);for(C=new S(Z),B=C.c=[],d=y.e-f.e,Z=c+d+1,u||(u=W,d=K(y.e/L)-K(f.e/L),Z=Z/L|0),p=0;k[p]==(z[p]||0);p++);if(k[p]>(z[p]||0)&&d--,Z<0)B.push(1),E=!0;else{for(De=z.length,Q=k.length,p=0,Z+=2,b=$(u/(k[0]+1)),b>1&&(k=n(k,b,u),z=n(z,b,u),Q=k.length,De=z.length),ve=Q,I=z.slice(0,Q),N=I.length;N<Q;I[N++]=0);pe=k.slice(),pe=[0].concat(pe),Ue=k[0],k[1]>=u/2&&Ue++;do{if(b=0,a=o(k,I,Q,N),a<0){if(D=I[0],Q!=N&&(D=D*u+(I[1]||0)),b=$(D/Ue),b>1)for(b>=u&&(b=u-1),O=n(k,b,u),M=O.length,N=I.length;o(O,I,M,N)==1;)b--,l(O,Q<M?pe:k,M,u),M=O.length,a=1;else b==0&&(a=b=1),O=k.slice(),M=O.length;if(M<N&&(O=[0].concat(O)),l(I,O,N,u),N=I.length,a==-1)for(;o(k,I,Q,N)<1;)b++,l(I,Q<N?pe:k,N,u),N=I.length}else a===0&&(b++,I=[0]);B[p++]=b,I[0]?I[N++]=z[ve]||0:(I=[z[ve]],N=1)}while((ve++<De||I[0]!=null)&&Z--);E=I[0]!=null,B[0]||B.splice(0,1)}if(u==W){for(p=1,Z=B[0];Z>=10;Z/=10,p++);H(C,c+(C.e=p+d*L-1)+1,x,E)}else C.e=d,C.r=+E;return C}})();function qe(n,o,l,y){var f,c,x,u,a;if(l==null?l=g:P(l,0,8),!n.c)return n.toString();if(f=n.c[0],x=n.e,o==null)a=X(n.c),a=y==1||y==2&&(x<=v||x>=w)?me(a,x):ee(a,x,"0");else if(n=H(new S(n),o,l),c=n.e,a=X(n.c),u=a.length,y==1||y==2&&(o<=c||c<=v)){for(;u<o;a+="0",u++);a=me(a,c)}else if(o-=x,a=ee(a,c,"0"),c+1>u){if(--o>0)for(a+=".";o--;a+="0");}else if(o+=c-u,o>0)for(c+1==u&&(a+=".");o--;a+="0");return n.s<0&&f?"-"+a:a}function ot(n,o){for(var l,y,f=1,c=new S(n[0]);f<n.length;f++)y=new S(n[f]),(!y.s||(l=re(c,y))===o||l===0&&c.s===o)&&(c=y);return c}function Fe(n,o,l){for(var y=1,f=o.length;!o[--f];o.pop());for(f=o[0];f>=10;f/=10,y++);return(l=y+l*L-1)>R?n.c=n.e=null:l<T?n.c=[n.e=0]:(n.e=l,n.c=o),n}r=(function(){var n=/^(-?)0([xbo])(?=\w[\w.]*$)/i,o=/^([^.]+)\.$/,l=/^\.([^.]+)$/,y=/^-?(Infinity|NaN)$/,f=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(c,x,u,a){var d,p=u?x:x.replace(f,"");if(y.test(p))c.s=isNaN(p)?null:p<0?-1:1;else{if(!u&&(p=p.replace(n,function(E,b,O){return d=(O=O.toLowerCase())=="x"?16:O=="b"?2:8,!a||a==d?b:E}),a&&(d=a,p=p.replace(o,"$1").replace(l,"0.$1")),x!=p))return new S(p,d);if(S.DEBUG)throw Error(V+"Not a"+(a?" base "+a:"")+" number: "+x);c.s=null}c.c=c.e=null}})();function H(n,o,l,y){var f,c,x,u,a,d,p,E=n.c,b=_e;if(E){e:{for(f=1,u=E[0];u>=10;u/=10,f++);if(c=o-f,c<0)c+=L,x=o,a=E[d=0],p=$(a/b[f-x-1]%10);else if(d=be((c+1)/L),d>=E.length)if(y){for(;E.length<=d;E.push(0));a=p=0,f=1,c%=L,x=c-L+1}else break e;else{for(a=u=E[d],f=1;u>=10;u/=10,f++);c%=L,x=c-L+f,p=x<0?0:$(a/b[f-x-1]%10)}if(y=y||o<0||E[d+1]!=null||(x<0?a:a%b[f-x-1]),y=l<4?(p||y)&&(l==0||l==(n.s<0?3:2)):p>5||p==5&&(l==4||y||l==6&&(c>0?x>0?a/b[f-x]:0:E[d-1])%10&1||l==(n.s<0?8:7)),o<1||!E[0])return E.length=0,y?(o-=n.e+1,E[0]=b[(L-o%L)%L],n.e=-o||0):E[0]=n.e=0,n;if(c==0?(E.length=d,u=1,d--):(E.length=d+1,u=b[L-c],E[d]=x>0?$(a/b[f-x]%b[x])*u:0),y)for(;;)if(d==0){for(c=1,x=E[0];x>=10;x/=10,c++);for(x=E[0]+=u,u=1;x>=10;x/=10,u++);c!=u&&(n.e++,E[0]==W&&(E[0]=1));break}else{if(E[d]+=u,E[d]!=W)break;E[d--]=0,u=1}for(c=E.length;E[--c]===0;E.pop());}n.e>R?n.c=n.e=null:n.e<T&&(n.c=[n.e=0])}return n}function ie(n){var o,l=n.e;return l===null?n.toString():(o=X(n.c),o=l<=v||l>=w?me(o,l):ee(o,l,"0"),n.s<0?"-"+o:o)}return s.absoluteValue=s.abs=function(){var n=new S(this);return n.s<0&&(n.s=1),n},s.comparedTo=function(n,o){return re(this,new S(n,o))},s.decimalPlaces=s.dp=function(n,o){var l,y,f,c=this;if(n!=null)return P(n,0,G),o==null?o=g:P(o,0,8),H(new S(c),n+c.e+1,o);if(!(l=c.c))return null;if(y=((f=l.length-1)-K(this.e/L))*L,f=l[f])for(;f%10==0;f/=10,y--);return y<0&&(y=0),y},s.dividedBy=s.div=function(n,o){return e(this,new S(n,o),m,g)},s.dividedToIntegerBy=s.idiv=function(n,o){return e(this,new S(n,o),0,1)},s.exponentiatedBy=s.pow=function(n,o){var l,y,f,c,x,u,a,d,p,E=this;if(n=new S(n),n.c&&!n.isInteger())throw Error(V+"Exponent not an integer: "+ie(n));if(o!=null&&(o=new S(o)),u=n.e>14,!E.c||!E.c[0]||E.c[0]==1&&!E.e&&E.c.length==1||!n.c||!n.c[0])return p=new S(Math.pow(+ie(E),u?n.s*(2-ye(n)):+ie(n))),o?p.mod(o):p;if(a=n.s<0,o){if(o.c?!o.c[0]:!o.s)return new S(NaN);y=!a&&E.isInteger()&&o.isInteger(),y&&(E=E.mod(o))}else{if(n.e>9&&(E.e>0||E.e<-1||(E.e==0?E.c[0]>1||u&&E.c[1]>=24e7:E.c[0]<8e13||u&&E.c[0]<=9999975e7)))return c=E.s<0&&ye(n)?-0:0,E.e>-1&&(c=1/c),new S(a?1/c:c);q&&(c=be(q/L+2))}for(u?(l=new S(.5),a&&(n.s=1),d=ye(n)):(f=Math.abs(+ie(n)),d=f%2),p=new S(h);;){if(d){if(p=p.times(E),!p.c)break;c?p.c.length>c&&(p.c.length=c):y&&(p=p.mod(o))}if(f){if(f=$(f/2),f===0)break;d=f%2}else if(n=n.times(l),H(n,n.e+1,1),n.e>14)d=ye(n);else{if(f=+ie(n),f===0)break;d=f%2}E=E.times(E),c?E.c&&E.c.length>c&&(E.c.length=c):y&&(E=E.mod(o))}return y?p:(a&&(p=h.div(p)),o?p.mod(o):c?H(p,q,g,x):p)},s.integerValue=function(n){var o=new S(this);return n==null?n=g:P(n,0,8),H(o,o.e+1,n)},s.isEqualTo=s.eq=function(n,o){return re(this,new S(n,o))===0},s.isFinite=function(){return!!this.c},s.isGreaterThan=s.gt=function(n,o){return re(this,new S(n,o))>0},s.isGreaterThanOrEqualTo=s.gte=function(n,o){return(o=re(this,new S(n,o)))===1||o===0},s.isInteger=function(){return!!this.c&&K(this.e/L)>this.c.length-2},s.isLessThan=s.lt=function(n,o){return re(this,new S(n,o))<0},s.isLessThanOrEqualTo=s.lte=function(n,o){return(o=re(this,new S(n,o)))===-1||o===0},s.isNaN=function(){return!this.s},s.isNegative=function(){return this.s<0},s.isPositive=function(){return this.s>0},s.isZero=function(){return!!this.c&&this.c[0]==0},s.minus=function(n,o){var l,y,f,c,x=this,u=x.s;if(n=new S(n,o),o=n.s,!u||!o)return new S(NaN);if(u!=o)return n.s=-o,x.plus(n);var a=x.e/L,d=n.e/L,p=x.c,E=n.c;if(!a||!d){if(!p||!E)return p?(n.s=-o,n):new S(E?x:NaN);if(!p[0]||!E[0])return E[0]?(n.s=-o,n):new S(p[0]?x:g==3?-0:0)}if(a=K(a),d=K(d),p=p.slice(),u=a-d){for((c=u<0)?(u=-u,f=p):(d=a,f=E),f.reverse(),o=u;o--;f.push(0));f.reverse()}else for(y=(c=(u=p.length)<(o=E.length))?u:o,u=o=0;o<y;o++)if(p[o]!=E[o]){c=p[o]<E[o];break}if(c&&(f=p,p=E,E=f,n.s=-n.s),o=(y=E.length)-(l=p.length),o>0)for(;o--;p[l++]=0);for(o=W-1;y>u;){if(p[--y]<E[y]){for(l=y;l&&!p[--l];p[l]=o);--p[l],p[y]+=W}p[y]-=E[y]}for(;p[0]==0;p.splice(0,1),--d);return p[0]?Fe(n,p,d):(n.s=g==3?-1:1,n.c=[n.e=0],n)},s.modulo=s.mod=function(n,o){var l,y,f=this;return n=new S(n,o),!f.c||!n.s||n.c&&!n.c[0]?new S(NaN):!n.c||f.c&&!f.c[0]?new S(f):(A==9?(y=n.s,n.s=1,l=e(f,n,0,3),n.s=y,l.s*=y):l=e(f,n,0,A),n=f.minus(l.times(n)),!n.c[0]&&A==1&&(n.s=f.s),n)},s.multipliedBy=s.times=function(n,o){var l,y,f,c,x,u,a,d,p,E,b,O,M,C,B,I=this,N=I.c,D=(n=new S(n,o)).c;if(!N||!D||!N[0]||!D[0])return!I.s||!n.s||N&&!N[0]&&!D||D&&!D[0]&&!N?n.c=n.e=n.s=null:(n.s*=I.s,!N||!D?n.c=n.e=null:(n.c=[0],n.e=0)),n;for(y=K(I.e/L)+K(n.e/L),n.s*=I.s,a=N.length,E=D.length,a<E&&(M=N,N=D,D=M,f=a,a=E,E=f),f=a+E,M=[];f--;M.push(0));for(C=W,B=ne,f=E;--f>=0;){for(l=0,b=D[f]%B,O=D[f]/B|0,x=a,c=f+x;c>f;)d=N[--x]%B,p=N[x]/B|0,u=O*d+p*b,d=b*d+u%B*B+M[c]+l,l=(d/C|0)+(u/B|0)+O*p,M[c--]=d%C;M[c]=l}return l?++y:M.splice(0,1),Fe(n,M,y)},s.negated=function(){var n=new S(this);return n.s=-n.s||null,n},s.plus=function(n,o){var l,y=this,f=y.s;if(n=new S(n,o),o=n.s,!f||!o)return new S(NaN);if(f!=o)return n.s=-o,y.minus(n);var c=y.e/L,x=n.e/L,u=y.c,a=n.c;if(!c||!x){if(!u||!a)return new S(f/0);if(!u[0]||!a[0])return a[0]?n:new S(u[0]?y:f*0)}if(c=K(c),x=K(x),u=u.slice(),f=c-x){for(f>0?(x=c,l=a):(f=-f,l=u),l.reverse();f--;l.push(0));l.reverse()}for(f=u.length,o=a.length,f-o<0&&(l=a,a=u,u=l,o=f),f=0;o;)f=(u[--o]=u[o]+a[o]+f)/W|0,u[o]=W===u[o]?0:u[o]%W;return f&&(u=[f].concat(u),++x),Fe(n,u,x)},s.precision=s.sd=function(n,o){var l,y,f,c=this;if(n!=null&&n!==!!n)return P(n,1,G),o==null?o=g:P(o,0,8),H(new S(c),n,o);if(!(l=c.c))return null;if(f=l.length-1,y=f*L+1,f=l[f]){for(;f%10==0;f/=10,y--);for(f=l[0];f>=10;f/=10,y++);}return n&&c.e+1>y&&(y=c.e+1),y},s.shiftedBy=function(n){return P(n,-Oe,Oe),this.times("1e"+n)},s.squareRoot=s.sqrt=function(){var n,o,l,y,f,c=this,x=c.c,u=c.s,a=c.e,d=m+4,p=new S("0.5");if(u!==1||!x||!x[0])return new S(!u||u<0&&(!x||x[0])?NaN:x?c:1/0);if(u=Math.sqrt(+ie(c)),u==0||u==1/0?(o=X(x),(o.length+a)%2==0&&(o+="0"),u=Math.sqrt(+o),a=K((a+1)/2)-(a<0||a%2),u==1/0?o="5e"+a:(o=u.toExponential(),o=o.slice(0,o.indexOf("e")+1)+a),l=new S(o)):l=new S(u+""),l.c[0]){for(a=l.e,u=a+d,u<3&&(u=0);;)if(f=l,l=p.times(f.plus(e(c,f,d,1))),X(f.c).slice(0,u)===(o=X(l.c)).slice(0,u))if(l.e<a&&--u,o=o.slice(u-3,u+1),o=="9999"||!y&&o=="4999"){if(!y&&(H(f,f.e+m+2,0),f.times(f).eq(c))){l=f;break}d+=4,u+=4,y=1}else{(!+o||!+o.slice(1)&&o.charAt(0)=="5")&&(H(l,l.e+m+2,1),n=!l.times(l).eq(c));break}}return H(l,l.e+m+1,g,n)},s.toExponential=function(n,o){return n!=null&&(P(n,0,G),n++),qe(this,n,o,1)},s.toFixed=function(n,o){return n!=null&&(P(n,0,G),n=n+this.e+1),qe(this,n,o)},s.toFormat=function(n,o,l){var y,f=this;if(l==null)n!=null&&o&&typeof o=="object"?(l=o,o=null):n&&typeof n=="object"?(l=n,n=o=null):l=U;else if(typeof l!="object")throw Error(V+"Argument not an object: "+l);if(y=f.toFixed(n,o),f.c){var c,x=y.split("."),u=+l.groupSize,a=+l.secondaryGroupSize,d=l.groupSeparator||"",p=x[0],E=x[1],b=f.s<0,O=b?p.slice(1):p,M=O.length;if(a&&(c=u,u=a,a=c,M-=c),u>0&&M>0){for(c=M%u||u,p=O.substr(0,c);c<M;c+=u)p+=d+O.substr(c,u);a>0&&(p+=d+O.slice(c)),b&&(p="-"+p)}y=E?p+(l.decimalSeparator||"")+((a=+l.fractionGroupSize)?E.replace(new RegExp("\\d{"+a+"}\\B","g"),"$&"+(l.fractionGroupSeparator||"")):E):p}return(l.prefix||"")+y+(l.suffix||"")},s.toFraction=function(n){var o,l,y,f,c,x,u,a,d,p,E,b,O=this,M=O.c;if(n!=null&&(u=new S(n),!u.isInteger()&&(u.c||u.s!==1)||u.lt(h)))throw Error(V+"Argument "+(u.isInteger()?"out of range: ":"not an integer: ")+ie(u));if(!M)return new S(O);for(o=new S(h),d=l=new S(h),y=a=new S(h),b=X(M),c=o.e=b.length-O.e-1,o.c[0]=_e[(x=c%L)<0?L+x:x],n=!n||u.comparedTo(o)>0?c>0?o:d:u,x=R,R=1/0,u=new S(b),a.c[0]=0;p=e(u,o,0,1),f=l.plus(p.times(y)),f.comparedTo(n)!=1;)l=y,y=f,d=a.plus(p.times(f=d)),a=f,o=u.minus(p.times(f=o)),u=f;return f=e(n.minus(l),y,0,1),a=a.plus(f.times(d)),l=l.plus(f.times(y)),a.s=d.s=O.s,c=c*2,E=e(d,y,c,g).minus(O).abs().comparedTo(e(a,l,c,g).minus(O).abs())<1?[d,y]:[a,l],R=x,E},s.toNumber=function(){return+ie(this)},s.toPrecision=function(n,o){return n!=null&&P(n,1,G),qe(this,n,o,2)},s.toString=function(n){var o,l=this,y=l.s,f=l.e;return f===null?y?(o="Infinity",y<0&&(o="-"+o)):o="NaN":(n==null?o=f<=v||f>=w?me(X(l.c),f):ee(X(l.c),f,"0"):n===10&&Ge?(l=H(new S(l),m+f+1,g),o=ee(X(l.c),l.e,"0")):(P(n,2,F.length,"Base"),o=t(ee(X(l.c),f,"0"),10,n,y,!0)),y<0&&l.c[0]&&(o="-"+o)),o},s.valueOf=s.toJSON=function(){return ie(this)},s._isBigNumber=!0,s[Symbol.toStringTag]="BigNumber",s[Symbol.for("nodejs.util.inspect.custom")]=s.valueOf,i!=null&&S.set(i),S}function K(i){var e=i|0;return i>0||i===e?e:e-1}function X(i){for(var e,t,r=1,s=i.length,h=i[0]+"";r<s;){for(e=i[r++]+"",t=L-e.length;t--;e="0"+e);h+=e}for(s=h.length;h.charCodeAt(--s)===48;);return h.slice(0,s+1||1)}function re(i,e){var t,r,s=i.c,h=e.c,m=i.s,g=e.s,v=i.e,w=e.e;if(!m||!g)return null;if(t=s&&!s[0],r=h&&!h[0],t||r)return t?r?0:-g:m;if(m!=g)return m;if(t=m<0,r=v==w,!s||!h)return r?0:!s^t?1:-1;if(!r)return v>w^t?1:-1;for(g=(v=s.length)<(w=h.length)?v:w,m=0;m<g;m++)if(s[m]!=h[m])return s[m]>h[m]^t?1:-1;return v==w?0:v>w^t?1:-1}function P(i,e,t,r){if(i<e||i>t||i!==$(i))throw Error(V+(r||"Argument")+(typeof i=="number"?i<e||i>t?" out of range: ":" not an integer: ":" not a primitive number: ")+String(i))}function ye(i){var e=i.c.length-1;return K(i.e/L)==e&&i.c[e]%2!=0}function me(i,e){return(i.length>1?i.charAt(0)+"."+i.slice(1):i)+(e<0?"e":"e+")+e}function ee(i,e,t){var r,s;if(e<0){for(s=t+".";++e;s+=t);i=s+i}else if(r=i.length,++e>r){for(s=t,e-=r;--e;s+=t);i+=s}else e<r&&(i=i.slice(0,e)+"."+i.slice(e));return i}var j=He(),yt=class{key;left=null;right=null;constructor(i){this.key=i}},fe=class extends yt{constructor(i){super(i)}},mt=class{size=0;modificationCount=0;splayCount=0;splay(i){const e=this.root;if(e==null)return this.compare(i,i),-1;let t=null,r=null,s=null,h=null,m=e;const g=this.compare;let v;for(;;)if(v=g(m.key,i),v>0){let w=m.left;if(w==null||(v=g(w.key,i),v>0&&(m.left=w.right,w.right=m,m=w,w=m.left,w==null)))break;t==null?r=m:t.left=m,t=m,m=w}else if(v<0){let w=m.right;if(w==null||(v=g(w.key,i),v<0&&(m.right=w.left,w.left=m,m=w,w=m.right,w==null)))break;s==null?h=m:s.right=m,s=m,m=w}else break;return s!=null&&(s.right=m.left,m.left=h),t!=null&&(t.left=m.right,m.right=r),this.root!==m&&(this.root=m,this.splayCount++),v}splayMin(i){let e=i,t=e.left;for(;t!=null;){const r=t;e.left=r.right,r.right=e,e=r,t=e.left}return e}splayMax(i){let e=i,t=e.right;for(;t!=null;){const r=t;e.right=r.left,r.left=e,e=r,t=e.right}return e}_delete(i){if(this.root==null||this.splay(i)!=0)return null;let t=this.root;const r=t,s=t.left;if(this.size--,s==null)this.root=t.right;else{const h=t.right;t=this.splayMax(s),t.right=h,this.root=t}return this.modificationCount++,r}addNewRoot(i,e){this.size++,this.modificationCount++;const t=this.root;if(t==null){this.root=i;return}e<0?(i.left=t,i.right=t.right,t.right=null):(i.right=t,i.left=t.left,t.left=null),this.root=i}_first(){const i=this.root;return i==null?null:(this.root=this.splayMin(i),this.root)}_last(){const i=this.root;return i==null?null:(this.root=this.splayMax(i),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(i){return this.validKey(i)&&this.splay(i)==0}defaultCompare(){return(i,e)=>i<e?-1:i>e?1:0}wrap(){return{getRoot:()=>this.root,setRoot:i=>{this.root=i},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:i=>{this.splayCount=i},splay:i=>this.splay(i),has:i=>this.has(i)}}},de=class ge extends mt{root=null;compare;validKey;constructor(e,t){super(),this.compare=e??this.defaultCompare(),this.validKey=t??(r=>r!=null&&r!=null)}delete(e){return this.validKey(e)?this._delete(e)!=null:!1}deleteAll(e){for(const t of e)this.delete(t)}forEach(e){const t=this[Symbol.iterator]();let r;for(;r=t.next(),!r.done;)e(r.value,r.value,this)}add(e){const t=this.splay(e);return t!=0&&this.addNewRoot(new fe(e),t),this}addAndReturn(e){const t=this.splay(e);return t!=0&&this.addNewRoot(new fe(e),t),this.root.key}addAll(e){for(const t of e)this.add(t)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)<0)return this.root.key;let r=this.root.left;if(r==null)return null;let s=r.right;for(;s!=null;)r=s,s=r.right;return r.key}firstAfter(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)>0)return this.root.key;let r=this.root.right;if(r==null)return null;let s=r.left;for(;s!=null;)r=s,s=r.left;return r.key}retainAll(e){const t=new ge(this.compare,this.validKey),r=this.modificationCount;for(const s of e){if(r!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(s)&&this.splay(s)==0&&t.add(this.root.key)}t.size!=this.size&&(this.root=t.root,this.size=t.size,this.modificationCount++)}lookup(e){return!this.validKey(e)||this.splay(e)!=0?null:this.root.key}intersection(e){const t=new ge(this.compare,this.validKey);for(const r of this)e.has(r)&&t.add(r);return t}difference(e){const t=new ge(this.compare,this.validKey);for(const r of this)e.has(r)||t.add(r);return t}union(e){const t=this.clone();return t.addAll(e),t}clone(){const e=new ge(this.compare,this.validKey);return e.size=this.size,e.root=this.copyNode(this.root),e}copyNode(e){if(e==null)return null;function t(s,h){let m,g;do{if(m=s.left,g=s.right,m!=null){const v=new fe(m.key);h.left=v,t(m,v)}if(g!=null){const v=new fe(g.key);h.right=v,s=g,h=v}}while(g!=null)}const r=new fe(e.key);return t(e,r),r}toSet(){return this.clone()}entries(){return new xt(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[Symbol.iterator](){return new dt(this.wrap())}[Symbol.toStringTag]="[object Set]"},Ze=class{tree;path=new Array;modificationCount=null;splayCount;constructor(i){this.tree=i,this.splayCount=i.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;const i=this.path[this.path.length-1];return this.getValue(i)}rebuildPath(i){this.path.splice(0,this.path.length),this.tree.splay(i),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(i){for(;i!=null;)this.path.push(i),i=i.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let t=this.tree.getRoot();for(;t!=null;)this.path.push(t),t=t.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let i=this.path[this.path.length-1],e=i.right;if(e!=null){for(;e!=null;)this.path.push(e),e=e.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===i;)i=this.path.pop();return this.path.length>0}},dt=class extends Ze{getValue(i){return i.key}},xt=class extends Ze{getValue(i){return[i.key,i.key]}},We=i=>()=>i,Le=i=>{const e=i?(t,r)=>r.minus(t).abs().isLessThanOrEqualTo(i):We(!1);return(t,r)=>e(t,r)?0:t.comparedTo(r)};function wt(i){const e=i?(t,r,s,h,m)=>t.exponentiatedBy(2).isLessThanOrEqualTo(h.minus(r).exponentiatedBy(2).plus(m.minus(s).exponentiatedBy(2)).times(i)):We(!1);return(t,r,s)=>{const h=t.x,m=t.y,g=s.x,v=s.y,w=m.minus(v).times(r.x.minus(g)).minus(h.minus(g).times(r.y.minus(v)));return e(w,h,m,g,v)?0:w.comparedTo(0)}}var Et=i=>i,vt=i=>{if(i){const e=new de(Le(i)),t=new de(Le(i)),r=(h,m)=>m.addAndReturn(h),s=h=>({x:r(h.x,e),y:r(h.y,t)});return s({x:new j(0),y:new j(0)}),s}return Et},Ie=i=>({set:e=>{te=Ie(e)},reset:()=>Ie(i),compare:Le(i),snap:vt(i),orient:wt(i)}),te=Ie(),ae=(i,e)=>i.ll.x.isLessThanOrEqualTo(e.x)&&e.x.isLessThanOrEqualTo(i.ur.x)&&i.ll.y.isLessThanOrEqualTo(e.y)&&e.y.isLessThanOrEqualTo(i.ur.y),Me=(i,e)=>{if(e.ur.x.isLessThan(i.ll.x)||i.ur.x.isLessThan(e.ll.x)||e.ur.y.isLessThan(i.ll.y)||i.ur.y.isLessThan(e.ll.y))return null;const t=i.ll.x.isLessThan(e.ll.x)?e.ll.x:i.ll.x,r=i.ur.x.isLessThan(e.ur.x)?i.ur.x:e.ur.x,s=i.ll.y.isLessThan(e.ll.y)?e.ll.y:i.ll.y,h=i.ur.y.isLessThan(e.ur.y)?i.ur.y:e.ur.y;return{ll:{x:t,y:s},ur:{x:r,y:h}}},xe=(i,e)=>i.x.times(e.y).minus(i.y.times(e.x)),je=(i,e)=>i.x.times(e.x).plus(i.y.times(e.y)),we=i=>je(i,i).sqrt(),St=(i,e,t)=>{const r={x:e.x.minus(i.x),y:e.y.minus(i.y)},s={x:t.x.minus(i.x),y:t.y.minus(i.y)};return xe(s,r).div(we(s)).div(we(r))},Rt=(i,e,t)=>{const r={x:e.x.minus(i.x),y:e.y.minus(i.y)},s={x:t.x.minus(i.x),y:t.y.minus(i.y)};return je(s,r).div(we(s)).div(we(r))},Je=(i,e,t)=>e.y.isZero()?null:{x:i.x.plus(e.x.div(e.y).times(t.minus(i.y))),y:t},Qe=(i,e,t)=>e.x.isZero()?null:{x:t,y:i.y.plus(e.y.div(e.x).times(t.minus(i.x)))},Tt=(i,e,t,r)=>{if(e.x.isZero())return Qe(t,r,i.x);if(r.x.isZero())return Qe(i,e,t.x);if(e.y.isZero())return Je(t,r,i.y);if(r.y.isZero())return Je(i,e,t.y);const s=xe(e,r);if(s.isZero())return null;const h={x:t.x.minus(i.x),y:t.y.minus(i.y)},m=xe(h,e).div(s),g=xe(h,r).div(s),v=i.x.plus(g.times(e.x)),w=t.x.plus(m.times(r.x)),T=i.y.plus(g.times(e.y)),R=t.y.plus(m.times(r.y)),_=v.plus(w).div(2),A=T.plus(R).div(2);return{x:_,y:A}},J=class lt{point;isLeft;segment;otherSE;consumedBy;static compare(e,t){const r=lt.comparePoints(e.point,t.point);return r!==0?r:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:Ee.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x.isLessThan(t.x)?-1:e.x.isGreaterThan(t.x)?1:e.y.isLessThan(t.y)?-1:e.y.isGreaterThan(t.y)?1:0}constructor(e,t){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const t=e.point.events;for(let r=0,s=t.length;r<s;r++){const h=t[r];this.point.events.push(h),h.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let t=0;t<e;t++){const r=this.point.events[t];if(r.segment.consumedBy===void 0)for(let s=t+1;s<e;s++){const h=this.point.events[s];h.consumedBy===void 0&&r.otherSE.point.events===h.otherSE.point.events&&r.segment.consume(h.segment)}}}getAvailableLinkedEvents(){const e=[];for(let t=0,r=this.point.events.length;t<r;t++){const s=this.point.events[t];s!==this&&!s.segment.ringOut&&s.segment.isInResult()&&e.push(s)}return e}getLeftmostComparator(e){const t=new Map,r=s=>{const h=s.otherSE;t.set(s,{sine:St(this.point,e.point,h.point),cosine:Rt(this.point,e.point,h.point)})};return(s,h)=>{t.has(s)||r(s),t.has(h)||r(h);const{sine:m,cosine:g}=t.get(s),{sine:v,cosine:w}=t.get(h);return m.isGreaterThanOrEqualTo(0)&&v.isGreaterThanOrEqualTo(0)?g.isLessThan(w)?1:g.isGreaterThan(w)?-1:0:m.isLessThan(0)&&v.isLessThan(0)?g.isLessThan(w)?-1:g.isGreaterThan(w)?1:0:v.isLessThan(m)?-1:v.isGreaterThan(m)?1:0}}},bt=class ze{events;poly;_isExteriorRing;_enclosingRing;static factory(e){const t=[];for(let r=0,s=e.length;r<s;r++){const h=e[r];if(!h.isInResult()||h.ringOut)continue;let m=null,g=h.leftSE,v=h.rightSE;const w=[g],T=g.point,R=[];for(;m=g,g=v,w.push(g),g.point!==T;)for(;;){const _=g.getAvailableLinkedEvents();if(_.length===0){const U=w[0].point,F=w[w.length-1].point;throw new Error(`Unable to complete output ring starting at [${U.x}, ${U.y}]. Last matching segment found ends at [${F.x}, ${F.y}].`)}if(_.length===1){v=_[0].otherSE;break}let A=null;for(let U=0,F=R.length;U<F;U++)if(R[U].point===g.point){A=U;break}if(A!==null){const U=R.splice(A)[0],F=w.splice(U.index);F.unshift(F[0].otherSE),t.push(new ze(F.reverse()));continue}R.push({index:w.length,point:g.point});const q=g.getLeftmostComparator(m);v=_.sort(q)[0].otherSE;break}t.push(new ze(w))}return t}constructor(e){this.events=e;for(let t=0,r=e.length;t<r;t++)e[t].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const t=[e];for(let w=1,T=this.events.length-1;w<T;w++){const R=this.events[w].point,_=this.events[w+1].point;te.orient(R,e,_)!==0&&(t.push(R),e=R)}if(t.length===1)return null;const r=t[0],s=t[1];te.orient(r,e,s)===0&&t.shift(),t.push(t[0]);const h=this.isExteriorRing()?1:-1,m=this.isExteriorRing()?0:t.length-1,g=this.isExteriorRing()?t.length:-1,v=[];for(let w=m;w!=g;w+=h)v.push([t[w].x.toNumber(),t[w].y.toNumber()]);return v}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let s=1,h=this.events.length;s<h;s++){const m=this.events[s];J.compare(e,m)>0&&(e=m)}let t=e.segment.prevInResult(),r=t?t.prevInResult():null;for(;;){if(!t)return null;if(!r)return t.ringOut;if(r.ringOut!==t.ringOut)return r.ringOut?.enclosingRing()!==t.ringOut?t.ringOut:t.ringOut?.enclosingRing();t=r.prevInResult(),r=t?t.prevInResult():null}}},et=class{exteriorRing;interiorRings;constructor(i){this.exteriorRing=i,i.poly=this,this.interiorRings=[]}addInterior(i){this.interiorRings.push(i),i.poly=this}getGeom(){const i=this.exteriorRing.getGeom();if(i===null)return null;const e=[i];for(let t=0,r=this.interiorRings.length;t<r;t++){const s=this.interiorRings[t].getGeom();s!==null&&e.push(s)}return e}},Ot=class{rings;polys;constructor(i){this.rings=i,this.polys=this._composePolys(i)}getGeom(){const i=[];for(let e=0,t=this.polys.length;e<t;e++){const r=this.polys[e].getGeom();r!==null&&i.push(r)}return i}_composePolys(i){const e=[];for(let t=0,r=i.length;t<r;t++){const s=i[t];if(!s.poly)if(s.isExteriorRing())e.push(new et(s));else{const h=s.enclosingRing();h?.poly||e.push(new et(h)),h?.poly?.addInterior(s)}}return e}},_t=class{queue;tree;segments;constructor(i,e=Ee.compare){this.queue=i,this.tree=new de(e),this.segments=[]}process(i){const e=i.segment,t=[];if(i.consumedBy)return i.isLeft?this.queue.delete(i.otherSE):this.tree.delete(e),t;i.isLeft&&this.tree.add(e);let r=e,s=e;do r=this.tree.lastBefore(r);while(r!=null&&r.consumedBy!=null);do s=this.tree.firstAfter(s);while(s!=null&&s.consumedBy!=null);if(i.isLeft){let h=null;if(r){const g=r.getIntersection(e);if(g!==null&&(e.isAnEndpoint(g)||(h=g),!r.isAnEndpoint(g))){const v=this._splitSafely(r,g);for(let w=0,T=v.length;w<T;w++)t.push(v[w])}}let m=null;if(s){const g=s.getIntersection(e);if(g!==null&&(e.isAnEndpoint(g)||(m=g),!s.isAnEndpoint(g))){const v=this._splitSafely(s,g);for(let w=0,T=v.length;w<T;w++)t.push(v[w])}}if(h!==null||m!==null){let g=null;h===null?g=m:m===null?g=h:g=J.comparePoints(h,m)<=0?h:m,this.queue.delete(e.rightSE),t.push(e.rightSE);const v=e.split(g);for(let w=0,T=v.length;w<T;w++)t.push(v[w])}t.length>0?(this.tree.delete(e),t.push(i)):(this.segments.push(e),e.prev=r)}else{if(r&&s){const h=r.getIntersection(s);if(h!==null){if(!r.isAnEndpoint(h)){const m=this._splitSafely(r,h);for(let g=0,v=m.length;g<v;g++)t.push(m[g])}if(!s.isAnEndpoint(h)){const m=this._splitSafely(s,h);for(let g=0,v=m.length;g<v;g++)t.push(m[g])}}}this.tree.delete(e)}return t}_splitSafely(i,e){this.tree.delete(i);const t=i.rightSE;this.queue.delete(t);const r=i.split(e);return r.push(t),i.consumedBy===void 0&&this.tree.add(i),r}},Lt=class{type;numMultiPolys;run(i,e,t){he.type=i;const r=[new it(e,!0)];for(let w=0,T=t.length;w<T;w++)r.push(new it(t[w],!1));if(he.numMultiPolys=r.length,he.type==="difference"){const w=r[0];let T=1;for(;T<r.length;)Me(r[T].bbox,w.bbox)!==null?T++:r.splice(T,1)}if(he.type==="intersection")for(let w=0,T=r.length;w<T;w++){const R=r[w];for(let _=w+1,A=r.length;_<A;_++)if(Me(R.bbox,r[_].bbox)===null)return[]}const s=new de(J.compare);for(let w=0,T=r.length;w<T;w++){const R=r[w].getSweepEvents();for(let _=0,A=R.length;_<A;_++)s.add(R[_])}const h=new _t(s);let m=null;for(s.size!=0&&(m=s.first(),s.delete(m));m;){const w=h.process(m);for(let T=0,R=w.length;T<R;T++){const _=w[T];_.consumedBy===void 0&&s.add(_)}s.size!=0?(m=s.first(),s.delete(m)):m=null}te.reset();const g=bt.factory(h.segments);return new Ot(g).getGeom()}},he=new Lt,Ae=he,It=0,Ee=class Se{id;leftSE;rightSE;rings;windings;ringOut;consumedBy;prev;_prevInResult;_beforeState;_afterState;_isInResult;static compare(e,t){const r=e.leftSE.point.x,s=t.leftSE.point.x,h=e.rightSE.point.x,m=t.rightSE.point.x;if(m.isLessThan(r))return 1;if(h.isLessThan(s))return-1;const g=e.leftSE.point.y,v=t.leftSE.point.y,w=e.rightSE.point.y,T=t.rightSE.point.y;if(r.isLessThan(s)){if(v.isLessThan(g)&&v.isLessThan(w))return 1;if(v.isGreaterThan(g)&&v.isGreaterThan(w))return-1;const R=e.comparePoint(t.leftSE.point);if(R<0)return 1;if(R>0)return-1;const _=t.comparePoint(e.rightSE.point);return _!==0?_:-1}if(r.isGreaterThan(s)){if(g.isLessThan(v)&&g.isLessThan(T))return-1;if(g.isGreaterThan(v)&&g.isGreaterThan(T))return 1;const R=t.comparePoint(e.leftSE.point);if(R!==0)return R;const _=e.comparePoint(t.rightSE.point);return _<0?1:_>0?-1:1}if(g.isLessThan(v))return-1;if(g.isGreaterThan(v))return 1;if(h.isLessThan(m)){const R=t.comparePoint(e.rightSE.point);if(R!==0)return R}if(h.isGreaterThan(m)){const R=e.comparePoint(t.rightSE.point);if(R<0)return 1;if(R>0)return-1}if(!h.eq(m)){const R=w.minus(g),_=h.minus(r),A=T.minus(v),q=m.minus(s);if(R.isGreaterThan(_)&&A.isLessThan(q))return 1;if(R.isLessThan(_)&&A.isGreaterThan(q))return-1}return h.isGreaterThan(m)?1:h.isLessThan(m)||w.isLessThan(T)?-1:w.isGreaterThan(T)?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,r,s){this.id=++It,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=r,this.windings=s}static fromRing(e,t,r){let s,h,m;const g=J.comparePoints(e,t);if(g<0)s=e,h=t,m=1;else if(g>0)s=t,h=e,m=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const v=new J(s,!0),w=new J(h,!1);return new Se(v,w,[r],[m])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e.isLessThan(t)?e:t},ur:{x:this.rightSE.point.x,y:e.isGreaterThan(t)?e:t}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(e){return e.x.eq(this.leftSE.point.x)&&e.y.eq(this.leftSE.point.y)||e.x.eq(this.rightSE.point.x)&&e.y.eq(this.rightSE.point.y)}comparePoint(e){return te.orient(this.leftSE.point,e,this.rightSE.point)}getIntersection(e){const t=this.bbox(),r=e.bbox(),s=Me(t,r);if(s===null)return null;const h=this.leftSE.point,m=this.rightSE.point,g=e.leftSE.point,v=e.rightSE.point,w=ae(t,g)&&this.comparePoint(g)===0,T=ae(r,h)&&e.comparePoint(h)===0,R=ae(t,v)&&this.comparePoint(v)===0,_=ae(r,m)&&e.comparePoint(m)===0;if(T&&w)return _&&!R?m:!_&&R?v:null;if(T)return R&&h.x.eq(v.x)&&h.y.eq(v.y)?null:h;if(w)return _&&m.x.eq(g.x)&&m.y.eq(g.y)?null:g;if(_&&R)return null;if(_)return m;if(R)return v;const A=Tt(h,this.vector(),g,e.vector());return A===null||!ae(s,A)?null:te.snap(A)}split(e){const t=[],r=e.events!==void 0,s=new J(e,!0),h=new J(e,!1),m=this.rightSE;this.replaceRightSE(h),t.push(h),t.push(s);const g=new Se(s,m,this.rings.slice(),this.windings.slice());return J.comparePoints(g.leftSE.point,g.rightSE.point)>0&&g.swapEvents(),J.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(s.checkForConsuming(),h.checkForConsuming()),t}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,r=this.windings.length;t<r;t++)this.windings[t]*=-1}consume(e){let t=this,r=e;for(;t.consumedBy;)t=t.consumedBy;for(;r.consumedBy;)r=r.consumedBy;const s=Se.compare(t,r);if(s!==0){if(s>0){const h=t;t=r,r=h}if(t.prev===r){const h=t;t=r,r=h}for(let h=0,m=r.rings.length;h<m;h++){const g=r.rings[h],v=r.windings[h],w=t.rings.indexOf(g);w===-1?(t.rings.push(g),t.windings.push(v)):t.windings[w]+=v}r.rings=null,r.windings=null,r.consumedBy=t,r.leftSE.consumedBy=t.leftSE,r.rightSE.consumedBy=t.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const t=this._afterState.rings,r=this._afterState.windings,s=this._afterState.multiPolys;for(let g=0,v=this.rings.length;g<v;g++){const w=this.rings[g],T=this.windings[g],R=t.indexOf(w);R===-1?(t.push(w),r.push(T)):r[R]+=T}const h=[],m=[];for(let g=0,v=t.length;g<v;g++){if(r[g]===0)continue;const w=t[g],T=w.poly;if(m.indexOf(T)===-1)if(w.isExterior)h.push(T);else{m.indexOf(T)===-1&&m.push(T);const R=h.indexOf(w.poly);R!==-1&&h.splice(R,1)}}for(let g=0,v=h.length;g<v;g++){const w=h[g].multiPoly;s.indexOf(w)===-1&&s.push(w)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(Ae.type){case"union":{const r=e.length===0,s=t.length===0;this._isInResult=r!==s;break}case"intersection":{let r,s;e.length<t.length?(r=e.length,s=t.length):(r=t.length,s=e.length),this._isInResult=s===Ae.numMultiPolys&&r<s;break}case"xor":{const r=Math.abs(e.length-t.length);this._isInResult=r%2===1;break}case"difference":{const r=s=>s.length===1&&s[0].isSubject;this._isInResult=r(e)!==r(t);break}}return this._isInResult}},tt=class{poly;isExterior;segments;bbox;constructor(i,e,t){if(!Array.isArray(i)||i.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=e,this.isExterior=t,this.segments=[],typeof i[0][0]!="number"||typeof i[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const r=te.snap({x:new j(i[0][0]),y:new j(i[0][1])});this.bbox={ll:{x:r.x,y:r.y},ur:{x:r.x,y:r.y}};let s=r;for(let h=1,m=i.length;h<m;h++){if(typeof i[h][0]!="number"||typeof i[h][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const g=te.snap({x:new j(i[h][0]),y:new j(i[h][1])});g.x.eq(s.x)&&g.y.eq(s.y)||(this.segments.push(Ee.fromRing(s,g,this)),g.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=g.x),g.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=g.y),g.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=g.x),g.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=g.y),s=g)}(!r.x.eq(s.x)||!r.y.eq(s.y))&&this.segments.push(Ee.fromRing(s,r,this))}getSweepEvents(){const i=[];for(let e=0,t=this.segments.length;e<t;e++){const r=this.segments[e];i.push(r.leftSE),i.push(r.rightSE)}return i}},Mt=class{multiPoly;exteriorRing;interiorRings;bbox;constructor(i,e){if(!Array.isArray(i))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new tt(i[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let t=1,r=i.length;t<r;t++){const s=new tt(i[t],this,!1);s.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=s.bbox.ll.x),s.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=s.bbox.ll.y),s.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=s.bbox.ur.x),s.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=s.bbox.ur.y),this.interiorRings.push(s)}this.multiPoly=e}getSweepEvents(){const i=this.exteriorRing.getSweepEvents();for(let e=0,t=this.interiorRings.length;e<t;e++){const r=this.interiorRings[e].getSweepEvents();for(let s=0,h=r.length;s<h;s++)i.push(r[s])}return i}},it=class{isSubject;polys;bbox;constructor(i,e){if(!Array.isArray(i))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof i[0][0][0]=="number"&&(i=[i])}catch{}this.polys=[],this.bbox={ll:{x:new j(Number.POSITIVE_INFINITY),y:new j(Number.POSITIVE_INFINITY)},ur:{x:new j(Number.NEGATIVE_INFINITY),y:new j(Number.NEGATIVE_INFINITY)}};for(let t=0,r=i.length;t<r;t++){const s=new Mt(i[t],this);s.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=s.bbox.ll.x),s.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=s.bbox.ll.y),s.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=s.bbox.ur.x),s.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=s.bbox.ur.y),this.polys.push(s)}this.isSubject=e}getSweepEvents(){const i=[];for(let e=0,t=this.polys.length;e<t;e++){const r=this.polys[e].getSweepEvents();for(let s=0,h=r.length;s<h;s++)i.push(r[s])}return i}},At=(i,...e)=>Ae.run("union",i,e);te.set;function Nt(i,e){var t,r,s,h,m,g,v,w,T,R,_=0,A=i.type==="FeatureCollection",q=i.type==="Feature",U=A?i.features.length:1;for(t=0;t<U;t++){for(g=A?i.features[t].geometry:q?i.geometry:i,w=A?i.features[t].properties:q?i.properties:{},T=A?i.features[t].bbox:q?i.bbox:void 0,R=A?i.features[t].id:q?i.id:void 0,v=g?g.type==="GeometryCollection":!1,m=v?g.geometries.length:1,s=0;s<m;s++){if(h=v?g.geometries[s]:g,h===null){if(e(null,_,w,T,R)===!1)return!1;continue}switch(h.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(h,_,w,T,R)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<h.geometries.length;r++)if(e(h.geometries[r],_,w,T,R)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}_++}}function Pt(i,e={}){const t=[];if(Nt(i,s=>{t.push(s.coordinates)}),t.length<2)throw new Error("Must have at least 2 geometries");const r=At(t[0],...t.slice(1));return r.length===0?null:r.length===1?Ye(r[0],e.properties):at(r,e.properties)}const nt=["NONE","OVERLAY_RECTS","OVERLAY_CIRCLES","GEOMETRY_CIRCLES"],Ct=(i,e)=>nt.indexOf(i)<nt.indexOf(e);let se=0,Ne,oe,ce,Pe,le="NONE",Ce="NONE",ke=!1,Be=i=>0,rt=64;self.onmessage=async function(i){const e=i.data.method;if(e=="set-data"){kt(i.data.index),Ne=i.data.data;const t=i.data.kilometersPerSecond,r=i.data.maxSeconds;Be=Bt(t,r),i.data.circleResolution&&i.data.circleResolution>2&&(rt=i.data.circleResolution)}else e=="set-max-level"&&(Ce=i.data.level,st())};function kt(i){se=i,oe=void 0,ce=void 0,Pe=void 0,le="NONE",Ce="NONE",Be=e=>0}function Bt(i,e){return t=>Math.min(t.seconds,e)*i}async function st(){if(ke||!Ct(le,Ce))return;ke=!0;const i=se,e=()=>i!=se;switch(le){case"NONE":await Gt().then(async t=>{if(e()){console.log("Index got stale while computing rects");return}oe=t,le="OVERLAY_RECTS",self.postMessage({method:"update-shape",index:se,level:"OVERLAY_RECTS",data:oe.map(r=>r.rect)}),await Ft(t).then(r=>{if(e()){console.log("Index got stale deleting covered rects");return}oe=r,self.postMessage({method:"update-shape",index:se,level:"OVERLAY_RECTS",data:oe.map(s=>s.rect)})})});break;case"OVERLAY_RECTS":await Dt().then(t=>{if(e()){console.log("Index got stale while computing circles");return}ce=t,le="OVERLAY_CIRCLES",self.postMessage({method:"update-shape",index:se,level:"OVERLAY_CIRCLES",data:ce})});break;case"OVERLAY_CIRCLES":await Ut().then(t=>{if(e()){console.log("Index got stale while computing geometry");return}Pe=t,le="GEOMETRY_CIRCLES",self.postMessage({method:"update-shape",index:se,level:"GEOMETRY_CIRCLES",data:Pe})});break;default:console.log(`Unexpected level '${le}'`)}ke=!1,st()}async function Gt(){if(Ne===void 0)return[];const i=Ne.map(async e=>{const t=Ve([e.lng,e.lat]),r=Be(e),s=ue(t,r,0,{units:"kilometers"}),h=ue(t,r,90,{units:"kilometers"}),m=ue(t,r,180,{units:"kilometers"});return{rect:{_sw:{lng:ue(t,r,-90,{units:"kilometers"}).geometry.coordinates[0],lat:m.geometry.coordinates[1]},_ne:{lng:h.geometry.coordinates[0],lat:s.geometry.coordinates[1]}},distance:r,data:e}});return await Promise.all(i)}function qt(i,e){const t=i.rect,r=e.rect;return t._sw.lat<=r._sw.lat&&t._sw.lng<=r._sw.lng&&t._ne.lat>=r._ne.lat&&t._ne.lng>=r._ne.lng}async function Ft(i){i.sort((s,h)=>h.distance-s.distance);const e=i.map(async(s,h)=>i.slice(0,h).some(m=>qt(m,s))),t=await Promise.all(e);return i.filter((s,h)=>!t[h])}async function Dt(){if(oe===void 0)return[];const i=oe.map(async e=>{const t=pt([e.data.lng,e.data.lat],e.distance,{steps:rt,units:"kilometers"});return t.bbox=[e.rect._sw.lng,e.rect._sw.lat,e.rect._ne.lng,e.rect._ne.lat],t});return await Promise.all(i)}async function Ut(){if(ce===void 0)return;const i=ce.map(e=>e);for(;i.length>1;){const e=i.shift(),t=i.shift(),r=Pt(ft([e,t]));r&&i.push(r)}return i.length==1?i[0]:void 0}})();
//# sourceMappingURL=IsochronesShapeWorker-BYXO2yI-.js.map
